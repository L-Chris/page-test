(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"../../src/index.js":function(e,t,i){"use strict";const s=Object.prototype,r=s.toString,d=(s.hasOwnProperty,()=>{});function o(e){return function(t){return r.call(t)==="[object "+e+"]"}}o("Error");const a=o("Function");o("Array"),o("Date");const n="VI_SYNC",l="CHILD_",c="PARENT_",h="ADD_IN_BROADCAST_LIST",p="DEL_IN_BROADCAST_LIST",u="INIT_STATE";class f{constructor({id:e,el:t}){this.id=e,this.el=t}update(e,t){this.el&&this.el.contentWindow.postMessage({type:e,payload:t},location.origin)}}class m{constructor({id:e,parent:t,store:i,created:s,destroyed:r}){this.id=e,this.store=i,this.parent=t||window.parent,this.createdCallback=a(s)?s:d,this.destroyedCallback=a(r)?r:d,this.init()}init(){const e=this,{id:t,store:i}=this,{_mutations:s}=i,{parentPrefix:r,childPrefix:d}=m;Object.entries(s).forEach(([e,t])=>{s[r+e]=t}),s[r+u]=[e=>{Object.assign(i.state,e)}],i.subscribe(({type:i,payload:s},o)=>{i.indexOf(r)>=0||e.send(d+i,{id:t,payload:s})}),window.addEventListener("load",this.load.bind(this)),window.addEventListener("message",this.update.bind(this)),window.addEventListener("beforeunload",this.unLoad.bind(this))}update({data:{type:e,payload:t}}){const{store:i}=this;if(!(e&&Reflect.has(i._mutations,e)||e===u))return;const{parentPrefix:s}=m;i.commit(s+e,t)}send(e,t){this.parent&&this.parent.postMessage({type:e,payload:t},location.origin)}load(){this.send(`${m.moduleName}/${h}`,this.id),this.created()}unLoad(){this.send(`${m.moduleName}/${p}`,this.id),this.destroyed()}created(){this.createdCallback(this.id,this.store,this.send.bind(this))}destroyed(){this.destroyedCallback(this.id,this.store,this.send.bind(this))}}m.moduleName="",m.parentPrefix="",m.childPrefix="";class y{constructor({ids:e,store:t}){this.allFrameIds=e.split(","),this.observerList=[],this.store=t,this.init()}addObserver(e){if(this.allFrameIds.indexOf(e)<0)return;const t=document.getElementById(e);if(t&&"IFRAME"===t.tagName){let i=new f({id:e,el:t});this.observerList.push(i),this.notifyObserver(i,{type:u,payload:function(e,t=[]){let i={};for(let s in e)t.indexOf(s)<0&&(i[s]=e[s]);return i}(this.store.state,[y.moduleName])})}}deleteObserver(e){const t=this.observerList.map(e=>e.id).indexOf(e);t>=0&&this.observerList.splice(t,1)}notifyObserver(e,{type:t,payload:i}){e.update(t,i)}notifyObservers({id:e,type:t,payload:i}){for(let s of this.observerList.filter(t=>t.id!==e))s.update(t,i)}init(){const e=this,{_mutations:t}=e.store,{moduleName:i,childPrefix:s}=y;e.store.registerModule(i,{namespaced:!0,mutations:{[h](t,i){e.addObserver(i)},[p](t,i){e.deleteObserver(i)}}}),Object.entries(t).forEach(([i,r])=>{t[s+i]=r.map(t=>({id:s,payload:r})=>{t(r),e.notifyObservers({id:s,type:i,payload:r})})});const r=new RegExp(`^(${s}|${i})`);e.store.subscribe(({type:t,payload:i},s)=>{r.test(t)||e.notifyObservers({type:t,payload:i})}),window.addEventListener("message",this.update.bind(this))}update({data:{type:e,payload:t}}){const{store:i}=this;e&&Reflect.has(i._mutations,e)&&i.commit(e,t)}}y.moduleName="",y.parentPrefix="",y.childPrefix="",i.d(t,"a",function(){return b}),i.d(t,"b",function(){return w});const b=(e,t={})=>i=>{let{moduleName:s,parentPrefix:r,childPrefix:d}=t;return y.moduleName=s||n,y.parentPrefix=r||c,y.childPrefix=d||l,new y({ids:e,store:i})},w=(e={})=>t=>{let{moduleName:i,parentPrefix:s,childPrefix:r,created:d,destroyed:o}=e;return m.moduleName=i||n,m.parentPrefix=s||c,m.childPrefix=r||l,new m({id:window.frameElement.id,store:t,created:d,destroyed:o})}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vRzovcHJvamVjdC92dWV4LWlmcmFtZS1zeW5jL3NyYy91dGlscy5qcyIsIndlYnBhY2s6Ly8vRzovcHJvamVjdC92dWV4LWlmcmFtZS1zeW5jL3NyYy9jb25zdC5qcyIsIndlYnBhY2s6Ly8vRzovcHJvamVjdC92dWV4LWlmcmFtZS1zeW5jL3NyYy9PYnNlcnZlci5qcyIsIndlYnBhY2s6Ly8vRzovcHJvamVjdC92dWV4LWlmcmFtZS1zeW5jL3NyYy9TdWJqZWN0LmpzIiwid2VicGFjazovLy9HOi9wcm9qZWN0L3Z1ZXgtaWZyYW1lLXN5bmMvc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbIm9Qcm90byIsIk9iamVjdCIsInByb3RvdHlwZSIsInV0aWxzX3RvU3RyaW5nIiwidG9TdHJpbmciLCJub29wIiwiaGFzT3duUHJvcGVydHkiLCJpc1R5cGUiLCJuYW1lIiwib2JqIiwiY2FsbCIsImlzRnVuY3Rpb24iLCJzdGF0aWNPcHRpb25zIiwiQUREX0lOX0JST0FEQ0FTVF9MSVNUIiwiREVMX0lOX0JST0FEQ0FTVF9MSVNUIiwiSU5JVF9TVEFURSIsIk9ic2VydmVyX09ic2VydmVySWZyYW1lIiwiW29iamVjdCBPYmplY3RdIiwiaWQiLCJlbCIsInRoaXMiLCJ0eXBlIiwicGF5bG9hZCIsImNvbnRlbnRXaW5kb3ciLCJwb3N0TWVzc2FnZSIsImxvY2F0aW9uIiwib3JpZ2luIiwiT2JzZXJ2ZXJfT2JzZXJ2ZXIiLCJwYXJlbnQiLCJzdG9yZSIsImNyZWF0ZWQiLCJkZXN0cm95ZWQiLCJ3aW5kb3ciLCJjcmVhdGVkQ2FsbGJhY2siLCJkZXN0cm95ZWRDYWxsYmFjayIsImluaXQiLCJ0aGF0IiwiX211dGF0aW9ucyIsIm11dGF0aW9ucyIsInBhcmVudFByZWZpeCIsImNoaWxkUHJlZml4IiwiZW50cmllcyIsImZvckVhY2giLCJmdW5jTGlzdCIsImFzc2lnbiIsInN0YXRlIiwic3Vic2NyaWJlIiwiaW5kZXhPZiIsInNlbmQiLCJhZGRFdmVudExpc3RlbmVyIiwibG9hZCIsImJpbmQiLCJ1cGRhdGUiLCJ1bkxvYWQiLCJkYXRhIiwiUmVmbGVjdCIsImhhcyIsImNvbW1pdCIsIm1vZHVsZU5hbWUiLCJTdWJqZWN0X1N1YmplY3QiLCJpZHMiLCJhbGxGcmFtZUlkcyIsInNwbGl0Iiwib2JzZXJ2ZXJMaXN0IiwiaWZyYW1lIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInRhZ05hbWUiLCJvYnNlcnZlciIsInB1c2giLCJub3RpZnlPYnNlcnZlciIsImF0dHJzIiwiY29weSIsImF0dHIiLCJjbG9uZVdpdGhvdXQiLCJpbmRleCIsIm1hcCIsIl8iLCJzcGxpY2UiLCJvYnMiLCJmaWx0ZXIiLCJyZWdpc3Rlck1vZHVsZSIsIm5hbWVzcGFjZWQiLCJhZGRPYnNlcnZlciIsImRlbGV0ZU9ic2VydmVyIiwiZiIsIm5vdGlmeU9ic2VydmVycyIsIlZBTElEX1RZUEVfUkUiLCJSZWdFeHAiLCJ0ZXN0Iiwic3JjX2Jyb2FkY2FzdCIsIm9wdGlvbnMiLCJzcmNfdHJhbnNmZXIiLCJmcmFtZUVsZW1lbnQiXSwibWFwcGluZ3MiOiIyR0FDQSxNQUFBQSxFQUFBQyxPQUFBQyxVQUNBQyxFQUFBSCxFQUFBSSxTQUdBQyxHQUZBTCxFQUFBTSxlQUVBLFFBRUEsU0FBQUMsRUFBQUMsR0FDQSxnQkFBQUMsR0FDQSxPQUFBTixFQUFBTyxLQUFBRCxLQUFBLFdBQUFELEVBQUEsS0FJQUQsRUFBQSxlQUNBSSxFQUFBSixFQUFBLFlBQ0FBLEVBQUEsU0FDQUEsRUFBQSxRQ2hCQSxNQUFBSyxFQUNBLFVBREFBLEVBRUEsU0FGQUEsRUFHQSxVQUlBQyxFQUFBLHdCQUNBQyxFQUFBLHdCQUNBQyxFQUFBLG1CQ0ZBQyxFQUNBQyxhQUFBQyxHQUFnQkEsRUFBQUMsT0FDaEJDLEtBQUFGLEtBQ0FFLEtBQUFELEtBR0FGLE9BQUFJLEVBQUFDLEdBQ0FGLEtBQUFELElBQUFDLEtBQUFELEdBQUFJLGNBQUFDLGFBQ0FILE9BQ0FDLFdBQ0tHLFNBQUFDLGVBSUxDLEVBQ0FWLGFBQUFD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cEZBLE1BQUFrRCxFQUFBLENBQUE5QixFQUFBK0IsT0FBMkM5RCxJQUMzQyxJQUFBNkIsV0FBT0EsRUFBQW5CLGVBQUFDLGVBQXNDbUQsRUFLN0MsT0FKQWhDLEVBQUFELGNBQUE5QyxFQUNBK0MsRUFBQXBCLGdCQUFBM0IsRUFDQStDLEVBQUFuQixlQUFBNUIsRUFFQSxJQUFBK0MsR0FBc0JDLE1BQUEvQixXQUl0QitELEVBQUEsQ0FBQUQsT0FBcUM5RCxJQUNyQyxJQUFBNkIsV0FBT0EsRUFBQW5CLGVBQUFDLGNBQUFWLFVBQUFDLGFBQTBENEQsRUFLakUsT0FKQWhFLEVBQUErQixjQUFBOUMsRUFDQWUsRUFBQVksZ0JBQUEzQixFQUNBZSxFQUFBYSxlQUFBNUIsRUFFQSxJQUFBZSxHQUNBVCxHQUFBYyxPQUFBNkQsYUFBQTNFLEdBQ0FXLFFBQ0FDLFVBQ0FDIiwiZmlsZSI6ImNvbW1vbnMuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHlwZSBjaGVja1xyXG5jb25zdCBvUHJvdG8gPSBPYmplY3QucHJvdG90eXBlXHJcbmNvbnN0IHRvU3RyaW5nID0gb1Byb3RvLnRvU3RyaW5nXHJcbmNvbnN0IGhhc093blByb3BlcnR5ID0gb1Byb3RvLmhhc093blByb3BlcnR5XHJcblxyXG5leHBvcnQgY29uc3Qgbm9vcCA9ICgpID0+IHt9XHJcblxyXG5mdW5jdGlvbiBpc1R5cGUgKG5hbWUpIHtcclxuICByZXR1cm4gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSdcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBpc0Vycm9yID0gaXNUeXBlKCdFcnJvcicpXHJcbmV4cG9ydCBjb25zdCBpc0Z1bmN0aW9uID0gaXNUeXBlKCdGdW5jdGlvbicpXHJcbmV4cG9ydCBjb25zdCBpc0FycmF5ID0gaXNUeXBlKCdBcnJheScpXHJcbmV4cG9ydCBjb25zdCBpc0RhdGUgPSBpc1R5cGUoJ0RhdGUnKVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzT2JqZWN0IChvYmopIHtcclxuICBsZXQgdHlwZSA9IHR5cGVvZiBvYmpcclxuICByZXR1cm4gKHR5cGUgPT09ICdmdW5jdGlvbicgfHwgdHlwZSA9PT0gJ29iamVjdCcpICYmICEhb2JqXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0VsZW1lbnQgKG9iaikge1xyXG4gIHJldHVybiAhIShvYmogJiYgb2JqLm5vZGVUeXBlID09PSAxKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xvbmVXaXRob3V0IChvYmosIGF0dHJzID0gW10pIHtcclxuICBsZXQgY29weSA9IHt9XHJcbiAgZm9yIChsZXQgYXR0ciBpbiBvYmopIHtcclxuICAgIGF0dHJzLmluZGV4T2YoYXR0cikgPCAwICYmIChjb3B5W2F0dHJdID0gb2JqW2F0dHJdKVxyXG4gIH1cclxuICByZXR1cm4gY29weVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVlcENsb25lIChvYmopIHtcclxuICBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSByZXR1cm4gb2JqXHJcblxyXG4gIGlmIChpc0RhdGUob2JqKSkge1xyXG4gICAgbGV0IGNvcHkgPSBuZXcgRGF0ZSgpXHJcbiAgICBjb3B5LnNldFRpbWUob2JqLmdldFRpbWUoKSlcclxuICAgIHJldHVybiBjb3B5XHJcbiAgfVxyXG5cclxuICBpZiAoaXNBcnJheShvYmopKSB7XHJcbiAgICByZXR1cm4gb2JqLm1hcChmdW5jdGlvbiAoXykge1xyXG4gICAgICByZXR1cm4gZGVlcENsb25lKF8pXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgaWYgKGlzT2JqZWN0KG9iaikpIHtcclxuICAgIGxldCBjb3B5ID0ge31cclxuICAgIGZvciAobGV0IGF0dHIgaW4gb2JqKSB7XHJcbiAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgYXR0cikpIGNvcHlbYXR0cl0gPSBkZWVwQ2xvbmUob2JqW2F0dHJdKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvcHlcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IHN0YXRpY09wdGlvbnMgPSB7XHJcbiAgbW9kdWxlTmFtZTogJ1ZJX1NZTkMnLFxyXG4gIGNoaWxkUHJlZml4OiAnQ0hJTERfJyxcclxuICBwYXJlbnRQcmVmaXg6ICdQQVJFTlRfJ1xyXG59XHJcblxyXG4vLyBtdXRhdGlvbiB0eXBlc1xyXG5leHBvcnQgY29uc3QgQUREX0lOX0JST0FEQ0FTVF9MSVNUID0gJ0FERF9JTl9CUk9BRENBU1RfTElTVCdcclxuZXhwb3J0IGNvbnN0IERFTF9JTl9CUk9BRENBU1RfTElTVCA9ICdERUxfSU5fQlJPQURDQVNUX0xJU1QnXHJcbmV4cG9ydCBjb25zdCBJTklUX1NUQVRFID0gJ0lOSVRfU1RBVEUnXHJcbiIsImltcG9ydCB7bm9vcCwgaXNGdW5jdGlvbn0gZnJvbSAnLi91dGlscydcclxuaW1wb3J0IHtcclxuICBBRERfSU5fQlJPQURDQVNUX0xJU1QsXHJcbiAgREVMX0lOX0JST0FEQ0FTVF9MSVNULFxyXG4gIElOSVRfU1RBVEVcclxufSBmcm9tICcuL2NvbnN0J1xyXG5cclxuZXhwb3J0IGNsYXNzIE9ic2VydmVySWZyYW1lIHtcclxuICBjb25zdHJ1Y3RvciAoe2lkLCBlbH0pIHtcclxuICAgIHRoaXMuaWQgPSBpZFxyXG4gICAgdGhpcy5lbCA9IGVsXHJcbiAgfVxyXG5cclxuICB1cGRhdGUgKHR5cGUsIHBheWxvYWQpIHtcclxuICAgIHRoaXMuZWwgJiYgdGhpcy5lbC5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKHtcclxuICAgICAgdHlwZSxcclxuICAgICAgcGF5bG9hZFxyXG4gICAgfSwgbG9jYXRpb24ub3JpZ2luKVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE9ic2VydmVyIHtcclxuICBjb25zdHJ1Y3RvciAoe2lkLCBwYXJlbnQsIHN0b3JlLCBjcmVhdGVkLCBkZXN0cm95ZWR9KSB7XHJcbiAgICB0aGlzLmlkID0gaWRcclxuICAgIHRoaXMuc3RvcmUgPSBzdG9yZVxyXG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQgfHwgd2luZG93LnBhcmVudFxyXG5cclxuICAgIHRoaXMuY3JlYXRlZENhbGxiYWNrID0gaXNGdW5jdGlvbihjcmVhdGVkKSA/IGNyZWF0ZWQgOiBub29wXHJcbiAgICB0aGlzLmRlc3Ryb3llZENhbGxiYWNrID0gaXNGdW5jdGlvbihkZXN0cm95ZWQpID8gZGVzdHJveWVkIDogbm9vcFxyXG4gICAgdGhpcy5pbml0KClcclxuICB9XHJcblxyXG4gIGluaXQgKCkge1xyXG4gICAgY29uc3QgdGhhdCA9IHRoaXNcclxuICAgIGNvbnN0IHtpZCwgc3RvcmV9ID0gdGhpc1xyXG4gICAgY29uc3Qge19tdXRhdGlvbnM6IG11dGF0aW9uc30gPSBzdG9yZVxyXG4gICAgY29uc3Qge3BhcmVudFByZWZpeCwgY2hpbGRQcmVmaXh9ID0gT2JzZXJ2ZXJcclxuXHJcbiAgICAvLyBhZGQgcGFyZW50IG11dGF0aW9uc1xyXG4gICAgT2JqZWN0LmVudHJpZXMobXV0YXRpb25zKS5mb3JFYWNoKChbdHlwZSwgZnVuY0xpc3RdKSA9PiB7XHJcbiAgICAgIG11dGF0aW9uc1twYXJlbnRQcmVmaXggKyB0eXBlXSA9IGZ1bmNMaXN0XHJcbiAgICB9KVxyXG4gICAgLy8gaW5pdCBtdXRhdGlvblxyXG4gICAgbXV0YXRpb25zW3BhcmVudFByZWZpeCArIElOSVRfU1RBVEVdID0gW3BheWxvYWQgPT4ge1xyXG4gICAgICBPYmplY3QuYXNzaWduKHN0b3JlLnN0YXRlLCBwYXlsb2FkKVxyXG4gICAgfV1cclxuXHJcbiAgICBzdG9yZS5zdWJzY3JpYmUoKHt0eXBlLCBwYXlsb2FkfSwgc3RhdGUpID0+IHtcclxuICAgICAgaWYgKHR5cGUuaW5kZXhPZihwYXJlbnRQcmVmaXgpID49IDApIHJldHVyblxyXG4gICAgICB0aGF0LnNlbmQoY2hpbGRQcmVmaXggKyB0eXBlLCB7aWQsIHBheWxvYWR9KVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBhZGQgYWRkRXZlbnRMaXN0ZW5lclxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB0aGlzLmxvYWQuYmluZCh0aGlzKSlcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy51cGRhdGUuYmluZCh0aGlzKSlcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLnVuTG9hZC5iaW5kKHRoaXMpKVxyXG4gIH1cclxuICB1cGRhdGUgKHsgZGF0YToge3R5cGUsIHBheWxvYWR9IH0pIHtcclxuICAgIGNvbnN0IHtzdG9yZX0gPSB0aGlzXHJcbiAgICBpZiAoKCF0eXBlIHx8ICFSZWZsZWN0LmhhcyhzdG9yZS5fbXV0YXRpb25zLCB0eXBlKSkgJiYgdHlwZSAhPT0gSU5JVF9TVEFURSkgcmV0dXJuXHJcbiAgICBjb25zdCB7cGFyZW50UHJlZml4fSA9IE9ic2VydmVyXHJcbiAgICBzdG9yZS5jb21taXQocGFyZW50UHJlZml4ICsgdHlwZSwgcGF5bG9hZClcclxuICB9XHJcblxyXG4gIHNlbmQgKHR5cGUsIHBheWxvYWQpIHtcclxuICAgIHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlLCBwYXlsb2FkfSwgbG9jYXRpb24ub3JpZ2luKVxyXG4gIH1cclxuXHJcbiAgbG9hZCAoKSB7XHJcbiAgICB0aGlzLnNlbmQoYCR7T2JzZXJ2ZXIubW9kdWxlTmFtZX0vJHtBRERfSU5fQlJPQURDQVNUX0xJU1R9YCwgdGhpcy5pZClcclxuICAgIHRoaXMuY3JlYXRlZCgpXHJcbiAgfVxyXG4gIHVuTG9hZCAoKSB7XHJcbiAgICB0aGlzLnNlbmQoYCR7T2JzZXJ2ZXIubW9kdWxlTmFtZX0vJHtERUxfSU5fQlJPQURDQVNUX0xJU1R9YCwgdGhpcy5pZClcclxuICAgIHRoaXMuZGVzdHJveWVkKClcclxuICB9XHJcblxyXG4gIC8vIGhvb2tcclxuICBjcmVhdGVkICgpIHtcclxuICAgIHRoaXMuY3JlYXRlZENhbGxiYWNrKHRoaXMuaWQsIHRoaXMuc3RvcmUsIHRoaXMuc2VuZC5iaW5kKHRoaXMpKVxyXG4gIH1cclxuICBkZXN0cm95ZWQgKCkge1xyXG4gICAgdGhpcy5kZXN0cm95ZWRDYWxsYmFjayh0aGlzLmlkLCB0aGlzLnN0b3JlLCB0aGlzLnNlbmQuYmluZCh0aGlzKSlcclxuICB9XHJcbn1cclxuXHJcbk9ic2VydmVyLm1vZHVsZU5hbWUgPSAnJ1xyXG5PYnNlcnZlci5wYXJlbnRQcmVmaXggPSAnJ1xyXG5PYnNlcnZlci5jaGlsZFByZWZpeCA9ICcnXHJcbiIsImltcG9ydCB7T2JzZXJ2ZXJJZnJhbWV9IGZyb20gJy4vT2JzZXJ2ZXInXHJcbmltcG9ydCB7Y2xvbmVXaXRob3V0fSBmcm9tICcuL3V0aWxzJ1xyXG5pbXBvcnQge1xyXG4gIEFERF9JTl9CUk9BRENBU1RfTElTVCxcclxuICBERUxfSU5fQlJPQURDQVNUX0xJU1QsXHJcbiAgSU5JVF9TVEFURVxyXG59IGZyb20gJy4vY29uc3QnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdWJqZWN0IHtcclxuICBjb25zdHJ1Y3RvciAoe2lkcywgc3RvcmV9KSB7XHJcbiAgICB0aGlzLmFsbEZyYW1lSWRzID0gaWRzLnNwbGl0KCcsJylcclxuICAgIHRoaXMub2JzZXJ2ZXJMaXN0ID0gW11cclxuICAgIHRoaXMuc3RvcmUgPSBzdG9yZVxyXG5cclxuICAgIHRoaXMuaW5pdCgpXHJcbiAgfVxyXG5cclxuICBhZGRPYnNlcnZlciAoaWQpIHtcclxuICAgIGlmICh0aGlzLmFsbEZyYW1lSWRzLmluZGV4T2YoaWQpIDwgMCkgcmV0dXJuXHJcbiAgICBjb25zdCBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZClcclxuICAgIGlmIChpZnJhbWUgJiYgaWZyYW1lLnRhZ05hbWUgPT09ICdJRlJBTUUnKSB7XHJcbiAgICAgIGxldCBvYnNlcnZlciA9IG5ldyBPYnNlcnZlcklmcmFtZSh7aWQsIGVsOiBpZnJhbWV9KVxyXG4gICAgICB0aGlzLm9ic2VydmVyTGlzdC5wdXNoKG9ic2VydmVyKVxyXG4gICAgICAvLyBpbml0aWFsaXphdGlvbiBzeW5jXHJcbiAgICAgIHRoaXMubm90aWZ5T2JzZXJ2ZXIob2JzZXJ2ZXIsIHtcclxuICAgICAgICB0eXBlOiBJTklUX1NUQVRFLFxyXG4gICAgICAgIHBheWxvYWQ6IGNsb25lV2l0aG91dCh0aGlzLnN0b3JlLnN0YXRlLCBbU3ViamVjdC5tb2R1bGVOYW1lXSlcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRlbGV0ZU9ic2VydmVyIChpZCkge1xyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLm9ic2VydmVyTGlzdC5tYXAoXyA9PiBfLmlkKS5pbmRleE9mKGlkKVxyXG4gICAgaW5kZXggPj0gMCAmJiB0aGlzLm9ic2VydmVyTGlzdC5zcGxpY2UoaW5kZXgsIDEpXHJcbiAgfVxyXG5cclxuICBub3RpZnlPYnNlcnZlciAob2JzLCB7dHlwZSwgcGF5bG9hZH0pIHtcclxuICAgIG9icy51cGRhdGUodHlwZSwgcGF5bG9hZClcclxuICB9XHJcblxyXG4gIG5vdGlmeU9ic2VydmVycyAoe2lkLCB0eXBlLCBwYXlsb2FkfSkge1xyXG4gICAgZm9yIChsZXQgb2JzIG9mIHRoaXMub2JzZXJ2ZXJMaXN0LmZpbHRlcihfID0+IF8uaWQgIT09IGlkKSkge1xyXG4gICAgICBvYnMudXBkYXRlKHR5cGUsIHBheWxvYWQpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbml0ICgpIHtcclxuICAgIGNvbnN0IHRoYXQgPSB0aGlzXHJcbiAgICBjb25zdCB7X211dGF0aW9uczogbXV0YXRpb25zfSA9IHRoYXQuc3RvcmVcclxuICAgIGNvbnN0IHttb2R1bGVOYW1lLCBjaGlsZFByZWZpeH0gPSBTdWJqZWN0XHJcblxyXG4gICAgdGhhdC5zdG9yZS5yZWdpc3Rlck1vZHVsZShtb2R1bGVOYW1lLCB7XHJcbiAgICAgIG5hbWVzcGFjZWQ6IHRydWUsXHJcbiAgICAgIG11dGF0aW9uczoge1xyXG4gICAgICAgIFtBRERfSU5fQlJPQURDQVNUX0xJU1RdIChzdGF0ZSwgaWQpIHtcclxuICAgICAgICAgIHRoYXQuYWRkT2JzZXJ2ZXIoaWQpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBbREVMX0lOX0JST0FEQ0FTVF9MSVNUXSAoc3RhdGUsIGlkKSB7XHJcbiAgICAgICAgICB0aGF0LmRlbGV0ZU9ic2VydmVyKGlkKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBhZGQgY2hpbGQgbXV0YXRpb25zXHJcbiAgICBPYmplY3QuZW50cmllcyhtdXRhdGlvbnMpLmZvckVhY2goKFt0eXBlLCBmdW5jTGlzdF0pID0+IHtcclxuICAgICAgbXV0YXRpb25zW2NoaWxkUHJlZml4ICsgdHlwZV0gPSBmdW5jTGlzdC5tYXAoZiA9PiAoe2lkLCBwYXlsb2FkfSkgPT4ge1xyXG4gICAgICAgIGYocGF5bG9hZClcclxuICAgICAgICB0aGF0Lm5vdGlmeU9ic2VydmVycyh7aWQsIHR5cGUsIHBheWxvYWR9KVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICBjb25zdCBWQUxJRF9UWVBFX1JFID0gbmV3IFJlZ0V4cChgXigke2NoaWxkUHJlZml4fXwke21vZHVsZU5hbWV9KWApXHJcbiAgICB0aGF0LnN0b3JlLnN1YnNjcmliZSgoe3R5cGUsIHBheWxvYWR9LCBzdGF0ZSkgPT4ge1xyXG4gICAgICBpZiAoVkFMSURfVFlQRV9SRS50ZXN0KHR5cGUpKSByZXR1cm5cclxuICAgICAgdGhhdC5ub3RpZnlPYnNlcnZlcnMoe3R5cGUsIHBheWxvYWR9KVxyXG4gICAgfSlcclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMudXBkYXRlLmJpbmQodGhpcykpXHJcbiAgfVxyXG5cclxuICB1cGRhdGUgKHsgZGF0YToge3R5cGUsIHBheWxvYWR9IH0pIHtcclxuICAgIGNvbnN0IHtzdG9yZX0gPSB0aGlzXHJcbiAgICBpZiAoIXR5cGUgfHwgIVJlZmxlY3QuaGFzKHN0b3JlLl9tdXRhdGlvbnMsIHR5cGUpKSByZXR1cm5cclxuICAgIHN0b3JlLmNvbW1pdCh0eXBlLCBwYXlsb2FkKVxyXG4gIH1cclxufVxyXG5cclxuU3ViamVjdC5tb2R1bGVOYW1lID0gJydcclxuU3ViamVjdC5wYXJlbnRQcmVmaXggPSAnJ1xyXG5TdWJqZWN0LmNoaWxkUHJlZml4ID0gJydcclxuIiwiaW1wb3J0IFN1YmplY3QgZnJvbSAnLi9TdWJqZWN0J1xyXG5pbXBvcnQge09ic2VydmVyfSBmcm9tICcuL09ic2VydmVyJ1xyXG5pbXBvcnQge3N0YXRpY09wdGlvbnN9IGZyb20gJy4vY29uc3QnXHJcblxyXG4vLyBzeW5jIGZyb20gcGFyZW50IHRvIGlmcmFtZVxyXG5leHBvcnQgY29uc3QgYnJvYWRjYXN0ID0gKGlkcywgb3B0aW9ucyA9IHt9KSA9PiBzdG9yZSA9PiB7XHJcbiAgbGV0IHttb2R1bGVOYW1lLCBwYXJlbnRQcmVmaXgsIGNoaWxkUHJlZml4fSA9IG9wdGlvbnNcclxuICBTdWJqZWN0Lm1vZHVsZU5hbWUgPSBtb2R1bGVOYW1lIHx8IHN0YXRpY09wdGlvbnMubW9kdWxlTmFtZVxyXG4gIFN1YmplY3QucGFyZW50UHJlZml4ID0gcGFyZW50UHJlZml4IHx8IHN0YXRpY09wdGlvbnMucGFyZW50UHJlZml4XHJcbiAgU3ViamVjdC5jaGlsZFByZWZpeCA9IGNoaWxkUHJlZml4IHx8IHN0YXRpY09wdGlvbnMuY2hpbGRQcmVmaXhcclxuXHJcbiAgcmV0dXJuIG5ldyBTdWJqZWN0KHtpZHMsIHN0b3JlfSlcclxufVxyXG5cclxuLy8gc3luYyBmcm9tIGlmcmFtZSB0byBwYXJlbnQgb3Igb3RoZXIgaWZyYW1lXHJcbmV4cG9ydCBjb25zdCB0cmFuc2ZlciA9IChvcHRpb25zID0ge30pID0+IHN0b3JlID0+IHtcclxuICBsZXQge21vZHVsZU5hbWUsIHBhcmVudFByZWZpeCwgY2hpbGRQcmVmaXgsIGNyZWF0ZWQsIGRlc3Ryb3llZH0gPSBvcHRpb25zXHJcbiAgT2JzZXJ2ZXIubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWUgfHwgc3RhdGljT3B0aW9ucy5tb2R1bGVOYW1lXHJcbiAgT2JzZXJ2ZXIucGFyZW50UHJlZml4ID0gcGFyZW50UHJlZml4IHx8IHN0YXRpY09wdGlvbnMucGFyZW50UHJlZml4XHJcbiAgT2JzZXJ2ZXIuY2hpbGRQcmVmaXggPSBjaGlsZFByZWZpeCB8fCBzdGF0aWNPcHRpb25zLmNoaWxkUHJlZml4XHJcblxyXG4gIHJldHVybiBuZXcgT2JzZXJ2ZXIoe1xyXG4gICAgaWQ6IHdpbmRvdy5mcmFtZUVsZW1lbnQuaWQsXHJcbiAgICBzdG9yZSxcclxuICAgIGNyZWF0ZWQsXHJcbiAgICBkZXN0cm95ZWRcclxuICB9KVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=